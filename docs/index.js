function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}loadConfig();function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}customElements.define("scanned-box",class extends HTMLElement{constructor(){super();const a=document.getElementById("scanned-box").content.cloneNode(!0);a.querySelector(".cursor").onclick=function(){this.parentNode.remove()},this.attachShadow({mode:"open"}).appendChild(a)}});function _toISBN10(d){d+="";let a=[];a=d.substr(3,9).split("");let e=0,c,b;for(let b=0;b<9;b++)e+=a[b]*(10-b);return chk_tmp=11-e%11,c==10?b="x":c==11?b=0:b=c,a.push(b),a.join("")}function toISBN13(g,h){const e=10,f=3;let d=h.trim().toUpperCase().replace(/[^\dX]/gi,"");d=g+d;let c=0;const a=d.split("");for(let b=0;b<a.length-1;b++)b%2==0?c+=parseInt(a[b]):c+=f*parseInt(a[b]);c=e-c%e;let b="";for(let c=0;c<a.length-1;c++)b=b+a[c];return b=b+c,b}function isValidISBN13(e){const c=10,f=3,d=e.trim().toUpperCase().replace(/[^\d]/gi,"");if(d.length!=13)return!1;let a=0;const b=d.split("");for(let c=0;c<b.length-1;c++)c%2==0?a+=parseInt(b[c]):a+=f*parseInt(b[c]);return a=c-a%c,a==parseInt(b[b.length-1])}function isValidISBN10(g){const d=11;let e=10;const f=g.trim().toUpperCase().replace(/[^\dX]/gi,"");if(f.length!=10)return!1;let b=0;const a=f.split("");for(let c=0;c<a.length-1;c++)b+=e*parseInt(a[c]),e--;b=d-b%d;let c=10;return a[a.length-1]!="X"&&(c=parseInt(a[a.length-1])),b==c}function _isISBN13(a){return!!(a.startsWith("978")||a.startsWith("979"))}function isValidEAN(a){a=("00000"+a).slice(-13);let b=0,c=0;for(let d=0;d<a.length-1;d++)d%2==0?c+=parseInt(a[d]):b+=parseInt(a[d]);return 10-parseInt((b*3+c).toString().slice(-1))===parseInt(a.slice(-1))}function getInfoFromISBN(b,a){fetch("https://app.rakuten.co.jp/services/api/Product/Search/20170426?format=json&affiliateId=1fce7ad4.9ceb2f6a.1fce7ad5.f0e8d979&applicationId=1017197774015471253&keyword="+b).then(a=>a.json()).then(b=>{if(b.hits>0){const d=b.Products[0].Product,e=d.productName,f=d.affiliateUrl,c=document.createElement("a");c.href=f,c.textContent=e,a&&a(c)}})}function _getInfoFromISBNByGoogle(b,a){fetch("https://www.googleapis.com/books/v1/volumes?q="+b).then(a=>a.json()).then(b=>{if(b.totalItems>0){const c=b.items[0].volumeInfo.title,d=document.createTextNode(c);a&&a(d)}})}function setProductInfo(a){const b=document.createElement("scanned-box"),c=b.shadowRoot.querySelector(".product");b.shadowRoot.querySelector(".code").textContent=a.text,isValidISBN13(a.text)?getInfoFromISBN(a.text,a=>{c.appendChild(a)}):isValidISBN10(a.text)?["978","979"].some(b=>{const d=toISBN13(b,a.text);if(isValidISBN13(d))return getInfoFromISBN(a.text,a=>{c.appendChild(productInfo)}),!0}):isValidEAN(a.text)&&getInfoFromISBN(a.text,a=>{c.appendChild(a)}),tbody.insertBefore(b.shadowRoot,tbody.children[1]),waiting=!0,setTimeout(()=>{waiting=!1},1e3)}let waiting=!1;const codeReader=new ZXing.BrowserMultiFormatReader,tbody=document.getElementById("memo").querySelector("tr").parentNode;codeReader.getVideoInputDevices().then(a=>{const b=a[0].deviceId;codeReader.decodeFromVideoDevice(b,"video",(a,b)=>{!waiting&&a&&(tbody.children.length==1?setProductInfo(a):tbody.children[1].children[0].textContent!=a.text&&setProductInfo(a))})}).catch(a=>{console.error(a)});function toCSV(){let a="";const b=[...document.getElementById("memo").querySelector("tr").parentNode.children];b.forEach(b=>{const c=[...b.children].slice(0,2).map(a=>a.textContent).join(", ");a+=c+"\n"}),copyToClipboard(a)}function iosCopyToClipboard(a){if(a=typeof a=="string"?document.querySelector(a):a,navigator.userAgent.match(/ipad|ipod|iphone/i)){const d=a.contentEditable,e=a.readOnly;a.contentEditable=!0,a.readOnly=!0;const b=document.createRange();b.selectNodeContents(a);const c=window.getSelection();c.removeAllRanges(),c.addRange(b),a.setSelectionRange(0,999999),a.contentEditable=d,a.readOnly=e}else a.select();document.execCommand("copy")}function copyToClipboard(b){const a=document.createElement("textarea");document.body.appendChild(a),a.value=b,iosCopyToClipboard(a),document.body.removeChild(a),alert("クリップボードにコピーしました。")}document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("toCSV").onclick=toCSV